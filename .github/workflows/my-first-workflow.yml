name: PR Validation
on: 
  pull_request:
    branches: [ main ]
jobs:
  Compile-All:
    runs-on: ubuntu-latest
    steps:
      - run: |
          echo \
            "vars are github.event_name ${{ github.event_name }}" \
            "runner.os ${{ runner.os }}, github.ref ${{ github.ref }}" \
            "github.repository ${{ github.repository }}" \
            "job.status ${{ job.status }}"
      - uses: actions/checkout@v2
      - run: git show --stat
      - run: mvn --version 
      - run: cd installer && mvn clean compile
      - name: Comment on Compilation Failure
        uses: actions/github-script@0.3.0
        if: ${{ failure() }}
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { issue: { number: issue_number }, repo: { owner, repo }  } = context;
            github.issues.createComment({ issue_number, owner, repo, body: 'Compile failed! See GitHub Action output for results. PRs will not be merged if they break the build!' });
      - run: echo "üçè This job's status is ${{ job.status }}."
      - name: Comment on PR
        uses: actions/github-script@0.3.0
        if: github.event_name == 'pull_request'
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { issue: { number: issue_number }, repo: { owner, repo }  } = context;
            github.issues.createComment({ issue_number, owner, repo, body: 'Running' });
